from dataclasses import dataclass
from typing import List, Optional


@dataclass
class Prompt:
    id: int
    data: str


class PromptService:
    def __init__(self):
        # Коллекция промптов (добавляй новые DO1, DO2, DO3...)
        self.prompt_collection: List[Prompt] = [DO1, DO3]

    def get_prompt_by_id(self, prompt_id: int) -> Optional[str]:
        """Получить промпт по ID"""
        for prompt in self.prompt_collection:
            if prompt.id == prompt_id:
                return prompt.data
        return None

    def list_prompts(self) -> List[dict]:
        """Список доступных промптов"""
        return [
            {"id": p.id, "data_preview": p.data[:100] + "..."}
            for p in self.prompt_collection
        ]


DO1 = Prompt(
    id=1, data="""Простой промпт для тестирования. Верни JSON: {"test": "ok"}"""
)

DO3 = Prompt(
    id=3,
    data="""ЗАДАЧА: Анализ письма в конверте от Почты России и извлечение данных в JSON.

    Твоя задача — проанализировать файл, содержащий конверт и вложенные документы, выделить данные и вернуть ответ СТРОГО в формате JSON.

    ЭТАП 1: АНАЛИЗ ИСТОЧНИКОВ (ГДЕ ИСКАТЬ ДАННЫЕ)

    КОНВЕРТ (Приоритет для полей "*Конверта" и "НомерКонверта"):

    - Найди область отправителя на конверте. Извлеки: Наименование отправителя и полный Адрес.

    - Штрих-код Почты России (14 цифр) или трек-номер. Это - "НомерКонверта". Если более 1 штрих-кода на одной из сторон конверта - верни пустую строку.

    ПИСЬМО/ДОКУМЕНТ (Приоритет для остальных полей):

    - ОтправительДокумента: Определи по шапке/бланку письма (НЕ по конверту).

    - Адрес и Город: Извлеки из реквизитов в шапке письма. "ГородОтправителя" — только название города (без "г.").

    - Получатель: Ищи организацию-получателя. В приоритете ищи: "ТрансТехСервис", "УК ТрансТехСервис", "ТТС".

    - Даты и Номера: Ищи "Исх. №", "Дата". Дата должна быть в формате ГГГГММДД.

    - ИНН/КПП: Ищи в шапке или подвале документа.

    - Содержание: Кратко (1-2 предложения) сформулируй суть требований/просьбы.

    - VIN: Просканируй текст на наличие VIN-номеров (17 знаков, латиница+цифры). Собери их в массив.

    - ИдентификаторВидаДокумента: Перед заполнением поля "ИдентификаторВидаДокумента" важно учесть, какой вид организации отправил документ и какая содержится информация. Используйте следующую схему для выбора значения поля:

    Если письмо касается купленного автомобиля или автомобиля, принадлежащего клиенту, и содержит любое из следующих требований/жалоб (от любых организаций или физических лиц):

    - Возврат автомобиля,

    - Возврат денежных средств за автомобиль, страховку, дополнительные услуги,

    - Компенсацию расходов, убытков, ущерба,

    - Требование о замене автомобиля или устранении недостатков,

    - Жалобу на действия сотрудников автосалона/сервисного центра,

    - Любые негативные или позитивные эмоции клиента по отношению к автосалону, сервисному центру или их сотрудникам, следовательно ИдентификаторВидаДокумента = "Претензии".

    Если письмо содержит просьбу/требование о выдаче копии документа (от любых организаций или физических лиц): договора купли-продажи, акта выполненных работ, заказ-наряда, ПТС и т.п.
    следовательно ИдентификаторВидаДокумента = "Претензии".

    Если ни одно из вышеперечисленных условий не выполняется, то используйте следующую логику:

    Если ОтправительДокумента является организацией судебной системы (суд, прокуратура, следственный комитет, министерство юстиции, ФАС, Роспотребнадзор, комитеты защиты прав потребителей, департамент защиты прав потребителей и т.п.), выберите значение "Судебные".
    Исключения:
    Если организация связана с нарушениями ПДД (ГИБДД, ФССП, административная комиссия), проверьте содержание письма. Если письмо касается штрафов за нарушение ПДД, присвоите значение "Штрафы ГИБДД", иначе оставьте "Судебные".
    Если ОтправительДокумента связан с ФССП, СФР, и письмо касается задолженности по зарплате, по алиментам, по кредиту, категория - "Зарплатные".
    Если ОтправительДокумента связан с государственными органами финансовой сферы (налоговая служба, государственная статистика, фонд пенсионного и соцстрахования, минфин), присваивайте значение "Бухгалтерские".
    Если ОтправительДокумента — государственный орган кадровой направленности (военкомат, Минобороны, Минтруд), выбирайте категорию "Кадровые".
    Если ОтправительДокумента — коммунальный ресурсоснабжающая организация (электроэнергия, газ, вода), установите "Коммунальные".
    Если ОтправительДокумента — оператор связи (Мегафон, Билайн, МТС, Таттелеком), используйте значение "Связь".
    Если ОтправительДокумента — страховая компания, выберите "Страховые".
    Если ОтправительДокумента представляет коммерческое предприятие и письмо содержит коммерческое предложение, рекламу или приглашение на событие, выбирайте "Коммерческие".
    Если ОтправительДокумента неизвестен или сообщение носит иной характер, внимательно проанализируйте текст письма:
    Если письмо содержит договоры, приложения, акты выполненных работ, накладные, счета-фактуры, поручения, доверенности и прочие хозяйственно-правовые документы, ставьте "Первичные".
    Если письмо содержит информацию об участи в тендере - определите как "Тендерное".
    Если письмо несёт иную неясную цель, определите его как "Неопределённое".

    Важно: Категория "Претензии" имеет высший приоритет и должна быть применена, если содержание соответствует указанным выше критериям, независимо от типа отправителя (организация или физическое лицо).

    ПРОВЕРКА НА ОШИБКИ:

    Если внутри конверта документы от разных контрагентов или разным адресатам — верни JSON со статусом "Ошибка".

    ЭТАП 2: ФОРМИРОВАНИЕ ОТВЕТА

    Верни ответ ТОЛЬКО в формате JSON. Не добавляй пояснений.
    Если данных нет — оставляй пустую строку "" (для VIN — пустой массив []).

    СТРУКТУРА JSON:
    {
    "Статус": "Успешно",
    "ДатаДокумента": "ГГГГММДД",
    "НомерДокумента": "строка",
    "ВидДокумента": "вид документа (без привязки к перечню, своими словами)",
    "ИдентификаторВидаДокумента": "ИдентификаторВидаДокумента",
    "ОтправительДокумента": "строка (по бланку)",
    "ОтправительКонверта": "строка (с конверта)",
    "АдресОтправителя": "строка (из документа)",
    "АдресОтправителяКонверта": "строка (с конверта)",
    "ИННОтправителя": "строка",
    "ГородОтправителя": "название города (например: Казань)",
    "ОрганизацияПолучатель": "строка (приоритет ТТС)",
    "ИННПолучателя": "строка",
    "КПППолучателя": "строка",
    "VIN": ["VIN1", "VIN2"],
    "Содержание": "краткое изложение требований",
    "НомерКонверта": "штрихкод конверта"
    }

    Если обнаружена критическая ошибка (разные адресаты/отправители), верни:
    {
    "Статус": "Ошибка",
    "Причина": "описание причины"
    }
    """,
)
